#!/usr/bin/env bash

set -e
set -o pipefail

soho_config="/var/www/html/core-laravel8/config.php"
soho_db_user="$(grep -o "dbUser = '[^']*[^']'" "${soho_db_user}" | cut -d "=" -f 2 | sed "s/'//g;s/ //g")"
soho_db_password="$(grep -o "dbPass = '[^']*[^']'" "${soho_db_password}" | cut -d "=" -f 2 | sed "s/'//g;s/ //g")"
soho_db_name="$(grep -o "dbName = '[^']*[^']'" "${soho_db_name}" | cut -d "=" -f 2 | sed "s/'//g;s/ //g")"

# MySQL / MariaDB.
/usr/bin/mysqldump -u "${soho_db_user}" \
    -p"${soho_db_password}" \
    "${soho_db_name}" \
    | gzip > "/home/backup/$(date +%F)_sendy.sql.gz"